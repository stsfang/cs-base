

### HTTP和HTTPS的区别

SSL/TLS：SSL（安全套接子层）、TLS（传输层安全协议）

- 握手协议：

  - 客户端发送请求，向服务器索要并验证服务器的公钥（实际是 数字证书：数字签名+公钥）。

    >  请求包括：SSL/TLS协议版本；生产的随机数c1（用于产生【会话秘钥】）；密码套件列表如RSA加密算法
    >
    > 响应包括：确认SSL/TLS协议版本；服务器的随机数s1；确认的密码套件列表；服务器的数字证书；

  - 客户端使用浏览器的CA公钥验证CA的数字签名，验证通过，认为服务器的公钥可靠，然后产生会话秘钥并发送给服务器。

    > 请求：产生客户端随机数c2，同时将c1+s1+c2用服务器的公钥加密，产生本次 会话秘钥；通知服务器加密通信算法发生改变，使用会话秘钥加密通信；所有握手数据的摘要，发送给服务器校验；
    >
    > 响应：服务器收到随机数c2（公钥加密的），用服务器的私钥解密后得到c2，然后由c1+s1+c2计算出【会话秘钥】，至此，客户端和服务器同持有本次的【会话秘钥】；所有握手数据做摘要发送给客户端校验；

    可见，最后一个随机数c2使用了公钥加密、服务器私钥解密的非对称加密算法；而【会话秘钥】则是对称加密算法的秘钥。

- 记录协议：

### HTTP/1.1的性能优化之路

- HTTP/1.1的性能瓶颈

  （1）请求/响应头部未经压缩

  （2）发送冗长的首部，多次相同的首部造成资源浪费

  （3）队头阻塞，服务器按请求顺序响应，首个请求响应慢就会导致客户端无法及时收到响应，头部阻塞

  （4）没有请求优先级控制

  （5）只能从客户端开始，服务器只能被动响应

- HTTP/2.0的优化

  （1）HPack首部压缩。HPack算法，（Header Pack算法？），客户端和服务器端同时维护一张首部信息表，根据请求的首部生产一个索引号，以后相同请求首部的请求直接发送 索引号。

  （2）二进制格式。HTTP/2.0不再是纯文本的报文，而是全面采用了二进制格式；头信息帧和数据帧；二进制格式对人而言已经不具备可读性了，但是对计算机友好，计算机可以直接读取二进制而不需要将明文转码二进制，提升了数据传输效率。

  （3）数据流Stream。HTTP/2.0支持请求的无序发送，不同请求对应的数据包可以交叉发送，所以需要对同一个请求的每个数据包做标记，指出该数据包属于哪个请求或相应。请求对应的所有数据包称为一个数据流。每个数据流标记唯一的编号，客户端发出的请求标记编号为奇数，服务端响应的标记为偶数。

  （4）多路复用。HTTP/2.0可以在一个连接中并发多个请求或响应，而不用按照请求顺序一一对应。消除了HTTP/1.1的串行请求、排队等待导致的【队头阻塞】问题，降低了延迟，提高了连接的利用率。

  （5）服务器推送。改善传统的【请求-应答】模式，将服务器能够主动地向客户端发送消息让客户端先缓存起来。	

  >  Cache-Push：HTTP/2允许服务端在客户端放cache，又叫服务端push，也就是说，你没有请求的东西，我服务端可以先送给你放在你的本地缓存中。比如，你请求X，我服务端知道X依赖于Y，虽然你没有的请求Y，但我把把Y跟着X的请求一起返回客户端。

  

- HTTP/3.0的优化

  HTTP/2.0虽然是基于数据流，但是如果某个数据包发生了丢失重传，就会阻塞全部的HTTP请求。

  （1）UDP+QUIC（Quick UDP Internet Connection）。HTTP/3.0将TCP换成了UDP，同时为了保持TCP可靠传输的机制，将UDP之前使用QUIC协议。使用QUIC协议之后，当某个数据流的数据包丢失，只会阻塞这个数据流，而不会影响其他数据路。

  （2）首部压缩算法升级为 QPack

  （3）HTTPS建立一次安全的连接需要花费6次交互：3次握手建立TCP连接，3次握手建立TLS会话。QUIC直接把6次合并为3次，减少了交互次数。

  所以HTTP/3.0是基于UDP的伪TCP + TLS + HTTP/2.0的多路复用协议。

参考：

1. [HTTP的前世今生](https://coolshell.cn/articles/19840.html)
2. 